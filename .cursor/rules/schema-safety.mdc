description: "Schema safety: structured migrations with type safety and change tracking."
globs:
  - "sql/**/*"
  - "src/**/*"
alwaysApply: true

hardConstraints:
  - "Production: NEVER edit existing SQL files. Create new numbered migrations (e.g., 06_lists.sql)."
  - "When schema changes, update TypeScript types in src/lib/types*.ts in the SAME commit."
  - "When schema/RPC payloads change, update all callers (hooks, API handlers) and note migration strategy."
  - "Do not change public.get_subgraph signature without updating useSubgraph and GraphData types."
  - "All DB access via RPCs or server routes; no client-side SQL."

developmentExceptions:
  - "Local dev: direct schema edits allowed with team coordination."
  - "Testing environments: schema resets permitted for rapid iteration."

escapeHatch: "Emergency production fixes allowed with DBA approval and immediate follow-up migration."

verificationChecklist:
  - "Create new migration file for production changes."
  - "Run TypeScript compiler and fix type errors."
  - "Search codebase for references to changed fields."
  - "Document migration rationale (recommended: update project docs)."
